<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<title>WebSocket Test</title>
<body>
<style>
  #irc { overflow:auto; min-width:400px;}
  #player { float:left; }
  #output { clear:both; }
</style>
<script language="javascript" type="text/javascript">
  var player;

  // Websocket control
  var wsUri = "ws://localhost:8090/";
  var output;
  function init() {
    output = document.getElementById("output");
    testWebSocket();
  }
  function testWebSocket() {
    websocket = new WebSocket(wsUri);
    websocket.onopen = onOpen;
    websocket.onclose = onClose;
    websocket.onmessage = onMessage;
    websocket.onerror = onError;
  }
  function onOpen(evt) {
    writeToScreen("CONNECTED");
  }
  function onClose(evt) { writeToScreen("DISCONNECTED"); }
  function onMessage(evt) {
    if(evt.data == 'PING') return;
    writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
    var obj = JSON.parse(evt.data);
    switch(obj.cmd) {
      case 'PLAY':
        playTrack(obj.srcId, obj.trackId, obj['time']);
        break;
      default:
        break;
    }

  }
  function onError(evt) { writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data); }
  function writeToScreen(message) {
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
  }

  function playTrack(srcType, trackId, seconds) {
    switch(srcType) {
      case 'yt':
        player.loadVideoById(trackId, seconds);
        player.style.display = 'block';
        break;
      default:
        break;
    }
  }

  // youtube player
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  function onYouTubeIframeAPIReady() {
    new YT.Player('player', {
      width: 720,
      height:480,
      playerVars: {
        //'controls': 0,    // When a control widget is setup, uncomment
        'disablekb':0,
        'enablejsapi':1,
        'rel':0,
        'modestbranding':1,
        'iv_load_policy':3,
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }
  function onPlayerReady(evt) {
    player = evt.target;
    player.style.display = 'none';
  }
  function onPlayerStateChange(evt) {

  }

  window.addEventListener("load", init, false);
</script>

<h2>WebSocket Test</h2>
<div id="player"></div>
<div id="irc">
  <iframe src="https://kiwiirc.com/client/csc.nmu.edu/?nick=radio_user|?&theme=cli#nmu" style="border:0;width:100%;height:480px;"></iframe>
</div>
<div id="output"></div>
</body>
</html>
